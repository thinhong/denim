<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="denim"><title>denim benchmark • denim</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="denim benchmark"><meta property="og:description" content="denim"><meta property="og:image" content="/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">denim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/denim.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/denim_dsl.html">denim DSL</a>
    <a class="dropdown-item" href="../articles/multinomial.html">transition to multiple states</a>
    <a class="dropdown-item" href="../articles/nonparametric.html">nonparametric distribution</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>denim comparison</h6>
    <a class="dropdown-item" href="../articles/denim_benchmark.html">denim benchmark</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>migrate to denim</h6>
    <a class="dropdown-item" href="../articles/deSolve_to_denim.html">deSolve to denim</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/thinhong/denim/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>denim benchmark</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/thinhong/denim/blob/HEAD/vignettes/denim_benchmark.Rmd" class="external-link"><code>vignettes/denim_benchmark.Rmd</code></a></small>
      <div class="d-none name"><code>denim_benchmark.Rmd</code></div>
    </div>

    
    
<p>To assess denim’s performance, we benchmark it against other
available packages, listed in the table below.</p>
<table>
<colgroup>
<col width="12%" />
<col width="87%" />
</colgroup>
<thead>
<tr class="header">
<th>Package</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>uSEIR</td>
<td><p>2 implementations for uSEIR that will be tested</p>
<ul>
<li><p>Implementation in Python</p></li>
<li><p>Implementation in Cython</p></li>
</ul></td>
</tr>
<tr class="even">
<td>deSolve</td>
<td><p>3 ways to define model for deSolve that will be tested</p>
<ul>
<li><p>Model in R</p></li>
<li><p>Model in C</p></li>
<li><p>Model in Fortran</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>IONISE</td>
<td></td>
</tr>
<tr class="even">
<td>diffeqr</td>
<td><p>2 ways to run model in diffeqr will be tested</p>
<ul>
<li><p>Define model in R</p></li>
<li><p>Define model in Julia</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>odin</td>
<td>A manual implementation of denim’s algorithm, using odin is
tested</td>
</tr>
<tr class="even">
<td>denim</td>
<td><p>Two methods for defining distributions are tested:</p>
<ul>
<li><p>Built-in parametric functions</p></li>
<li><p>Histograms using the <code>nonparametric()</code>
function</p></li>
</ul></td>
</tr>
</tbody>
</table>
<p>The benchmarking process was conducted on a Macbook Pro with M2 Pro
chip, 16 GBs of RAM and 10 cores (6 performance and 4 efficiency).</p>
<details>
<summary>
Version specifications
</summary>
<table style="width:79%;">
<colgroup>
<col width="12%" />
<col width="13%" />
<col width="52%" />
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Version</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>R</td>
<td>4.3.0</td>
<td></td>
</tr>
<tr class="even">
<td>Python</td>
<td>3.9.20</td>
<td>For <code>uSEIR</code> Python and Cython</td>
</tr>
<tr class="odd">
<td>clang</td>
<td>17.0.0</td>
<td><p>C/C++ compiler for:</p>
<ul>
<li><p><code>uSEIR</code> Cython</p></li>
<li><p><code>odin</code></p></li>
<li><p><code>denim</code></p></li>
<li><p><code>deSolve</code> (model in C, Fortran)</p></li>
</ul></td>
</tr>
<tr class="even">
<td>Julia</td>
<td>1.9.4</td>
<td>For <code>diffeqr</code> package</td>
</tr>
</tbody>
</table>
<p>R utility packages</p>
<table>
<colgroup>
<col width="14%" />
<col width="10%" />
<col width="74%" />
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Version</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>tidyverse</td>
<td>2.0.0</td>
<td>For plotting, data formatting</td>
</tr>
<tr class="even">
<td>reticulate</td>
<td>1.41.0</td>
<td>For interfacting Python code (for uSEIR)</td>
</tr>
<tr class="odd">
<td>arrow</td>
<td>19.0.1</td>
<td>For interfacing uSEIR output without messing up the datatype</td>
</tr>
</tbody>
</table>
</details>
<p> </p>
<div id="benchmark-settings" class="section level2">
<h2>Benchmark settings</h2>
<p>All approaches will simulate the following SEIR model, with the same
simulation duration of 180. The dashed arrows indicate transitions
described using dwell time distributions while the solid arrow indicates
transition rate.</p>
<p><img src="/Users/anhptq/Desktop/denim/vignettes/images/denim_website-benchmark-mod.png"
width="700" /></p>
<p><code>beta</code> can also be computed as <span
class="math inline">\(beta = R_0/tr\)</span> where <span
class="math inline">\(R_0\)</span> is the basic reproduction number and
<span class="math inline">\(tr\)</span> is the infectious period.</p>
<p>Each approach will be run 50 times</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>total_runs <span class="ot">&lt;-</span> <span class="dv">50</span><span class="dt">L</span> <span class="co"># number of runs</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>sim_duration <span class="ot">&lt;-</span> <span class="dv">180</span> <span class="co"># duration of simulation</span></span></code></pre></div>
</div>
<div id="useir" class="section level2">
<h2>1. uSEIR</h2>
<p>Simulate model using uSEIR approach <span class="citation">(Hernández
et al. 2021)</span>.</p>
<p>Source code: <a
href="https://github.com/jjgomezcadenas/useirn/blob/master/nb/uSEIR.ipynb"
class="uri">https://github.com/jjgomezcadenas/useirn/blob/master/nb/uSEIR.ipynb</a></p>
<details>
<summary>
Dependency version specifications
</summary>
<p>Python packages</p>
<table>
<colgroup>
<col width="11%" />
<col width="11%" />
<col width="77%" />
</colgroup>
<thead>
<tr class="header">
<th>Package</th>
<th>Version</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>scipy</td>
<td>1.31.1</td>
<td>For handling dwell time distribution</td>
</tr>
<tr class="even">
<td>cython</td>
<td>3.0.11</td>
<td>For Cython implementation</td>
</tr>
<tr class="odd">
<td>numpy</td>
<td>2.0.2</td>
<td></td>
</tr>
<tr class="even">
<td>pandas</td>
<td>2.2.3</td>
<td></td>
</tr>
<tr class="odd">
<td>pyarrow</td>
<td>18.1.0</td>
<td>For interfacing output to R without messing up the datatype</td>
</tr>
</tbody>
</table>
</details>
<details>
<summary>
load useir implementation in pure Python
</summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span></code></pre></div>
<pre><code>## Warning: package &#39;reticulate&#39; was built under R version 4.3.3</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># use_python(&quot;/opt/anaconda3/envs/bnn/bin/python&quot;, required = TRUE)</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">use_condaenv</span>(<span class="at">condaenv=</span><span class="st">&#39;bnn&#39;</span>, <span class="at">required =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># matplotlib &lt;- import(&quot;matplotlib&quot;)</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># matplotlib$use(&quot;Agg&quot;, force = TRUE)</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="fu">py_run_file</span>(<span class="st">&quot;../supplements/useir_python.py&quot;</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co"># py_config()</span></span></code></pre></div>
</details>
<div id="python-implementation" class="section level3">
<h3>1.1. Python implementation</h3>
<details>
<summary>
Code for running uSEIR in pure Python
</summary>
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="im">import</span> concurrent.futures</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="im">from</span> statistics <span class="im">import</span> mean</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>python_runs <span class="op">=</span> []</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="kw">def</span> get_python_runtime(n):</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  start <span class="op">=</span> time.time()</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  df <span class="op">=</span> solve_uSeir(ti_shape     <span class="op">=</span> <span class="dv">2</span>,</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>                     ti_scale     <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>                     tr_shape     <span class="op">=</span> <span class="dv">2</span>,</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>                     tr_scale     <span class="op">=</span> <span class="dv">3</span>,</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>                     R0           <span class="op">=</span> <span class="fl">3.5</span>)</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>  end <span class="op">=</span> time.time()</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  <span class="cf">return</span> end <span class="op">-</span> start</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  </span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co"># load cached result if available instead of rerun due to long run time</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>cached_python_runs <span class="op">=</span> <span class="st">&quot;../supplements/cached_runs/python_runs.pkl&quot;</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a><span class="cf">if</span> os.path.exists(cached_python_runs):</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>  <span class="co"># If the file exists, load the Python list from the file</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>  <span class="cf">with</span> <span class="bu">open</span>(cached_python_runs, <span class="st">&#39;rb&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a>    python_runs <span class="op">=</span> pickle.load(f)</span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">&quot;no cache found&quot;</span>)</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>  <span class="co"># multithread instead for quicker result</span></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>  <span class="cf">with</span> concurrent.futures.ProcessPoolExecutor(max_workers<span class="op">=</span><span class="dv">8</span>) <span class="im">as</span> executor:</span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>    python_runs <span class="op">=</span> <span class="bu">list</span>(executor.<span class="bu">map</span>(get_python_runtime, <span class="bu">range</span>(r.total_runs)))</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>  <span class="co"># Save to cache</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>  <span class="cf">with</span> <span class="bu">open</span>(cached_python_runs, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> f:</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>      pickle.dump(python_runs, f)</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>      </span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a><span class="co"># print(f&#39;python solve_seir call: dr = {end-start}&#39;)</span></span></code></pre></div>
</details>
<p>Run time for uSEIR approach, Python implementation (in seconds)</p>
<pre><code>##  [1] 54.79370 54.23037 54.61863 54.13476 54.73439 54.35928 54.48391 54.56821
##  [9] 53.26567 53.35437 53.44551 53.31425 53.51092 53.19878 53.92493 53.84889
## [17] 54.05378 53.66922 53.65536 53.54520 53.73345 53.88690 54.23988 54.19460
## [25] 53.64543 53.55217 53.66061 53.67430 53.59397 53.65503 54.32232 53.98363
## [33] 53.53084 53.79021 53.85689 53.45313 53.61043 53.53294 54.00833 54.11180
## [41] 53.94760 53.61952 53.80676 53.74364 53.68474 53.63701 53.59615 53.81793
## [49] 44.74661 44.77127</code></pre>
<p>Median run time for uSEIR approach, Python implementation: 53.7090955
seconds</p>
</div>
<div id="cython-implementation" class="section level3">
<h3>1.2. Cython implementation</h3>
<details>
<summary>
Code for running uSEIR in Cython (C backend)
</summary>
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># import precompiled cython module</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">&quot;../supplements&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="im">import</span> useir</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>cython_runs <span class="op">=</span> []</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co"># --- Get runtime ----</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(r.total_runs):</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  start <span class="op">=</span> time.time()</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>  df <span class="op">=</span> useir.csolve_uSeir(dist <span class="op">=</span> <span class="st">&quot;gamma&quot;</span>,</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>                    ti_shape     <span class="op">=</span> <span class="dv">2</span>,</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>                     ti_scale     <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>                     tr_shape     <span class="op">=</span> <span class="dv">2</span>,</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>                     tr_scale     <span class="op">=</span> <span class="dv">3</span>,</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>                     R0           <span class="op">=</span> <span class="fl">3.5</span></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>  )</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>  end <span class="op">=</span> time.time()</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>  cython_runs <span class="op">=</span> cython_runs <span class="op">+</span> [end <span class="op">-</span> start]</span></code></pre></div>
<pre><code>##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334
##  Function compute_pde with sampling = Fine, time epsilon = 0.01
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 4702, infected compartments = 3526
## len pdE = 4702, max(pdE) =0.0009196976461058881 len pdi = 3526 max(pdI) =0.0012262625368251734
## prob = 0.5833333333333334, pn = 0.005833333333333334</code></pre>
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># ---- Get output for uSEIR -----</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>df <span class="op">=</span> useir.csolve_uSeir(dist <span class="op">=</span> <span class="st">&quot;gamma&quot;</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                    ti_shape     <span class="op">=</span> <span class="dv">2</span>,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                     ti_scale     <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>                     tr_shape     <span class="op">=</span> <span class="dv">2</span>,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>                     tr_scale     <span class="op">=</span> <span class="dv">3</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>                     R0           <span class="op">=</span> <span class="fl">3.5</span>,</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>                     pde_sampling <span class="op">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>##  Function compute_pde with sampling = , time epsilon = 0.1
##  statistical distribution = gamma, ti = 8.0, tr = 6.0
##  number of exposed compartments = 470, infected compartments = 352
## len pdE = 470, max(pdE) =0.009196039895832842 len pdi = 352 max(pdI) =0.01226041465028943
## prob = 0.5833333333333334, pn = 0.05833333333333334</code></pre>
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>  </span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co"># convert to pyarrow table for easy conversion to R data.frames</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>to_r_df <span class="op">=</span> pa.Table.from_pandas(df)</span></code></pre></div>
</details>
<p>Run time for uSEIR approach, Cython implementation (in seconds)</p>
<pre><code>##  [1] 0.4204161 0.4766951 0.4147639 0.4129088 0.4140410 0.4138477 0.4130261
##  [8] 0.4212909 0.4190290 0.4190660 0.4167402 0.4169221 0.4223282 0.4214261
## [15] 0.4183862 0.4258659 0.4213421 0.4203939 0.4140539 0.4189341 0.4143560
## [22] 0.4160459 0.4132569 0.4258149 0.4234819 0.4231689 0.4148700 0.4118659
## [29] 0.4141519 0.4160001 0.4115329 0.4168539 0.4263620 0.4209700 0.4172430
## [36] 0.4104204 0.4120522 0.4208171 0.4225249 0.4185033 0.4216430 0.4290931
## [43] 0.4313729 0.4218540 0.4188001 0.4174929 0.4225781 0.4190321 0.4265318
## [50] 0.4230540</code></pre>
<p>Median run time for uSEIR approach, Cython implementation: 0.4189816
seconds</p>
</div>
</div>
<div id="desolve" class="section level2">
<h2>2. deSolve</h2>
<p>Simulate model using deSolve package <span
class="citation">(Soetaert, Petzoldt, and Setzer 2008)</span></p>
<details>
<summary>
Dependency version specifications
</summary>
<p>R packages</p>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Version</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>deSolve</td>
<td>1.40</td>
<td></td>
</tr>
</tbody>
</table>
</details>
<div id="model-in-r" class="section level3">
<h3>2.1. Model in R</h3>
<details>
  <summary>Code for running SEIR in <code>deSolve</code></summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">library</span>(deSolve)</span></code></pre></div>
<pre><code>## Warning: package &#39;deSolve&#39; was built under R version 4.3.1</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">gamma_rate_I =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">shape_I=</span><span class="dv">2</span>,</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>                <span class="at">gamma_rate_R =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">shape_R =</span> <span class="dv">2</span>,</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>                <span class="at">R0 =</span> <span class="fl">3.5</span>, <span class="at">N =</span> <span class="fl">1e6</span>) </span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>initialValues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> <span class="dv">999999</span>, <span class="at">E1 =</span> <span class="dv">1</span>,</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>                   <span class="at">E2 =</span> <span class="dv">0</span>, <span class="at">E =</span> <span class="dv">0</span>, <span class="at">I1=</span><span class="dv">0</span>, </span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>                   <span class="at">I2=</span><span class="dv">0</span>, <span class="at">I=</span><span class="dv">0</span>, <span class="at">R=</span><span class="dv">0</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>                   )</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co"># --- Transition def for deSolve</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>transition_func <span class="ot">&lt;-</span> <span class="cf">function</span>(t, state, param){</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>( <span class="fu">c</span>(state, param) ), {</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>      tr <span class="ot">=</span> shape_R<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span>gamma_rate_R)</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>      </span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>      dS <span class="ot">=</span> <span class="sc">-</span> (R0<span class="sc">/</span>tr) <span class="sc">*</span> S <span class="sc">*</span> I<span class="sc">/</span>N</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>      <span class="co"># apply linear chain trick</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>      dE1 <span class="ot">=</span> (R0<span class="sc">/</span>tr) <span class="sc">*</span> S <span class="sc">*</span> I<span class="sc">/</span>N <span class="sc">-</span> gamma_rate_I<span class="sc">*</span>E1</span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a>      dE2 <span class="ot">=</span> gamma_rate_I<span class="sc">*</span>E1 <span class="sc">-</span> gamma_rate_I<span class="sc">*</span>E2</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a>      dE <span class="ot">=</span> dE1 <span class="sc">+</span> dE2</span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a>      dI1 <span class="ot">=</span> gamma_rate_I<span class="sc">*</span>E2 <span class="sc">-</span> gamma_rate_R<span class="sc">*</span>I1</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>      dI2 <span class="ot">=</span> gamma_rate_R<span class="sc">*</span>I1 <span class="sc">-</span> gamma_rate_R<span class="sc">*</span>I2</span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>      dI <span class="ot">=</span>  dI1 <span class="sc">+</span> dI2</span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a>      dR <span class="ot">=</span> gamma_rate_R<span class="sc">*</span>I2</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a>      <span class="fu">list</span>(<span class="fu">c</span>(dS, dE1, dE2, dE, dI1, dI2, dI, dR))</span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a>  })</span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a>}</span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, sim_duration, <span class="dv">1</span>)</span>
<span id="cb15-29"><a href="#cb15-29" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" tabindex="-1"></a><span class="co"># ------ Compute run time ------</span></span>
<span id="cb15-31"><a href="#cb15-31" tabindex="-1"></a>desolve_runs <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">is.null</span>(cached_runtime)){</span>
<span id="cb15-32"><a href="#cb15-32" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb15-33"><a href="#cb15-33" tabindex="-1"></a>    <span class="fu">ode</span>(<span class="at">y =</span> initialValues, <span class="at">times =</span> times, <span class="at">parms =</span> parameters, <span class="at">func =</span> transition_func),</span>
<span id="cb15-34"><a href="#cb15-34" tabindex="-1"></a>    <span class="at">iterations =</span> total_runs</span>
<span id="cb15-35"><a href="#cb15-35" tabindex="-1"></a>  )<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb15-36"><a href="#cb15-36" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb15-37"><a href="#cb15-37" tabindex="-1"></a>  cached_runtime<span class="sc">$</span>desolve_runs</span>
<span id="cb15-38"><a href="#cb15-38" tabindex="-1"></a>}</span>
<span id="cb15-39"><a href="#cb15-39" tabindex="-1"></a></span>
<span id="cb15-40"><a href="#cb15-40" tabindex="-1"></a>ode_mod <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> initialValues, <span class="at">times =</span> times, <span class="at">parms =</span> parameters, <span class="at">func =</span> transition_func)</span>
<span id="cb15-41"><a href="#cb15-41" tabindex="-1"></a>ode_mod <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ode_mod)</span></code></pre></div>
</details>
<p>Run time for <code>deSolve</code> implementation</p>
<pre><code>##  [1] 0.005304047 0.004200286 0.004217916 0.004035220 0.004270765 0.012629353
##  [7] 0.003946947 0.003625876 0.003706810 0.003715584 0.003655396 0.003381270
## [13] 0.003337974 0.003452651 0.003362410 0.003279467 0.003470978 0.003516816
## [19] 0.003786965 0.003310299 0.003598119 0.004339440 0.003422598 0.003559620
## [25] 0.009443735 0.003371717 0.003420794 0.003429978 0.003207963 0.003452446
## [31] 0.003531986 0.003424648 0.003343099 0.003396727 0.003252735 0.003071433
## [37] 0.003125102 0.003217844 0.003100502 0.003192178 0.003369790 0.003283485
## [43] 0.003259951 0.003304641 0.008277367 0.003261550 0.003233014 0.003116533
## [49] 0.003167250 0.003189923
## attr(,&quot;class&quot;)
## [1] &quot;bench_time&quot; &quot;numeric&quot;</code></pre>
<p>Median run time for deSolve, with model defined in R: 0.0034217
seconds</p>
</div>
<div id="model-in-c" class="section level3">
<h3>2.2. Model in C</h3>
<details>
  <summary>Code for running model defined in C</summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># compile model</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co"># system(&quot;R CMD SHLIB supplements/desolve_mod/benchmark_mod.c&quot;)</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co"># compiled file on Windows will have .dll extension instead of .so</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="fu">dyn.load</span>(<span class="st">&quot;../supplements/desolve_mod/benchmark_mod.so&quot;</span>)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>initialValues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> <span class="dv">999999</span>, <span class="at">E1 =</span> <span class="dv">1</span>,</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>                   <span class="at">E2 =</span> <span class="dv">0</span>, <span class="at">E =</span> <span class="dv">0</span>, <span class="at">I1=</span><span class="dv">0</span>, </span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>                   <span class="at">I2=</span><span class="dv">0</span>, <span class="at">I=</span><span class="dv">0</span>, <span class="at">R=</span><span class="dv">0</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>                   )</span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">R0 =</span> <span class="fl">3.5</span>, <span class="at">scale_I =</span> <span class="dv">4</span>, <span class="at">shape_I=</span><span class="dv">2</span>,</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>                <span class="at">scale_R =</span> <span class="dv">3</span>, <span class="at">shape_R =</span> <span class="dv">2</span>, <span class="at">N =</span> <span class="fl">1e6</span>) </span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>desolve_c_runs <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">is.null</span>(cached_runtime)){</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>    <span class="co"># run model defined in C</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>    <span class="fu">ode</span>(initialValues, times, <span class="at">func =</span> <span class="st">&quot;derivs&quot;</span>, <span class="at">parms =</span> parameters,</span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>    <span class="at">dllname =</span> <span class="st">&quot;benchmark_mod&quot;</span>, <span class="at">initfunc =</span> <span class="st">&quot;initmod&quot;</span>),</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>    <span class="at">iterations =</span> total_runs</span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>  )<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>  cached_runtime<span class="sc">$</span>desolve_c_runs</span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>}</span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="fu">dyn.unload</span>(<span class="st">&quot;../supplements/desolve_mod/benchmark_mod.so&quot;</span>)</span></code></pre></div>
</details>
<p>Run time for <code>deSolve</code> with model defined in C</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>desolve_c_runs</span></code></pre></div>
<pre><code>##  [1] 0.000195447 0.000139072 0.000399422 0.000122426 0.000197907 0.000121032
##  [7] 0.000118285 0.000171790 0.000116112 0.000162278 0.000117178 0.000122426
## [13] 0.000162032 0.000122057 0.000162237 0.000114595 0.000114841 0.000155062
## [19] 0.000113652 0.000162237 0.000116645 0.000125993 0.000158875 0.000124558
## [25] 0.000157276 0.000112668 0.000118859 0.000154857 0.000127510 0.000152479
## [31] 0.000113734 0.000126854 0.000161212 0.000123000 0.000154611 0.000119802
## [37] 0.000121114 0.000161622 0.000118367 0.000158957 0.000118695 0.000126567
## [43] 0.000157563 0.000127756 0.000156497 0.000121893 0.000114636 0.000165066
## [49] 0.000119597 0.000161089
## attr(,&quot;class&quot;)
## [1] &quot;bench_time&quot; &quot;numeric&quot;</code></pre>
<p>Median run time for deSolve, with model defined in C: 1.267105^{-4}
seconds</p>
</div>
<div id="model-in-fortran" class="section level3">
<h3>2.3. Model in Fortran</h3>
<details>
  <summary>Code for running model defined in C</summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># compile model in fortran</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co"># system(&quot;R CMD SHLIB supplements/desolve_mod/benchmark_mod_fortran.f&quot;)</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="fu">dyn.load</span>(<span class="st">&quot;../supplements/desolve_mod/benchmark_mod_fortran.so&quot;</span>)</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>initialValues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> <span class="dv">999999</span>, <span class="at">E1 =</span> <span class="dv">1</span>,</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>                   <span class="at">E2 =</span> <span class="dv">0</span>, <span class="at">E =</span> <span class="dv">0</span>, <span class="at">I1=</span><span class="dv">0</span>, </span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>                   <span class="at">I2=</span><span class="dv">0</span>, <span class="at">I=</span><span class="dv">0</span>, <span class="at">R=</span><span class="dv">0</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>                   )</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">R0 =</span> <span class="fl">3.5</span>, <span class="at">scale_I =</span> <span class="dv">4</span>, <span class="at">shape_I=</span><span class="dv">2</span>,</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>                <span class="at">scale_R =</span> <span class="dv">3</span>, <span class="at">shape_R =</span> <span class="dv">2</span>, <span class="at">N =</span> <span class="fl">1e6</span>) </span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>desolve_fortran_runs <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">is.null</span>(cached_runtime)){</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb20-16"><a href="#cb20-16" tabindex="-1"></a>    <span class="co"># run model defined in Fortran</span></span>
<span id="cb20-17"><a href="#cb20-17" tabindex="-1"></a>    <span class="fu">ode</span>(initialValues, times, <span class="at">func =</span> <span class="st">&quot;derivs&quot;</span>, <span class="at">parms =</span> parameters,</span>
<span id="cb20-18"><a href="#cb20-18" tabindex="-1"></a>    <span class="at">dllname =</span> <span class="st">&quot;benchmark_mod_fortran&quot;</span>, <span class="at">initfunc =</span> <span class="st">&quot;initmod&quot;</span>),</span>
<span id="cb20-19"><a href="#cb20-19" tabindex="-1"></a>    <span class="at">iterations =</span> total_runs</span>
<span id="cb20-20"><a href="#cb20-20" tabindex="-1"></a>  )<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb20-21"><a href="#cb20-21" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb20-22"><a href="#cb20-22" tabindex="-1"></a>  cached_runtime<span class="sc">$</span>desolve_fortran_runs</span>
<span id="cb20-23"><a href="#cb20-23" tabindex="-1"></a>}</span>
<span id="cb20-24"><a href="#cb20-24" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" tabindex="-1"></a><span class="fu">dyn.unload</span>(<span class="st">&quot;../supplements/desolve_mod/benchmark_mod_fortran.so&quot;</span>)</span></code></pre></div>
</details>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>desolve_fortran_runs</span></code></pre></div>
<pre><code>##  [1] 0.000305942 0.000602536 0.000193807 0.000299710 0.000181056 0.000173061
##  [7] 0.000247599 0.000164656 0.000215742 0.000166747 0.000161868 0.000208321
## [13] 0.000173389 0.000215701 0.000167936 0.000163385 0.000206435 0.000170519
## [19] 0.000203647 0.000159572 0.000162073 0.000200982 0.000157891 0.000203524
## [25] 0.000167075 0.000175644 0.000212257 0.000164656 0.000217628 0.000162483
## [31] 0.000160269 0.000207788 0.000165845 0.000209715 0.000164000 0.000158178
## [37] 0.000216357 0.000183065 0.000236816 0.000176915 0.000183270 0.000207583
## [43] 0.000166911 0.000204057 0.000168510 0.000173266 0.000214020 0.000169207
## [49] 0.000208813 0.000159900
## attr(,&quot;class&quot;)
## [1] &quot;bench_time&quot; &quot;numeric&quot;</code></pre>
<p>Median run time for deSolve, with model defined in Fortran:
1.789855^{-4} seconds</p>
</div>
</div>
<div id="ionise" class="section level2">
<h2>3. IONISE</h2>
<p>Simulate model using IONISE approach <span class="citation">(Hong et
al. 2024)</span>.</p>
<p>Source code: <a href="https://github.com/Mathbiomed/IONISE"
class="uri">https://github.com/Mathbiomed/IONISE</a></p>
<details>
<summary>
Code for running SEIR using <code>IONISE</code>
</summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># load code for IONISE</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;../supplements/ionise_mod/IONISE.R&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: package &#39;invgamma&#39; was built under R version 4.3.3</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># ------ Set up -------</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>ionise_time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, sim_duration, <span class="dv">1</span>)</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>ionise_params <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>  <span class="fl">3.5</span><span class="sc">/</span><span class="dv">6</span>, <span class="co"># beta </span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">4</span>, <span class="co"># rate and shape E -&gt; I transition</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>  <span class="dv">2</span>, <span class="dv">3</span> <span class="co"># rate and shape I -&gt; R transition</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>)</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>inonise_init <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="at">S_init =</span> <span class="dv">999999</span>, <span class="at">E_init =</span> <span class="dv">1</span>, <span class="at">I_init =</span> <span class="dv">0</span>, <span class="at">R_init =</span> <span class="dv">0</span>)</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co"># ------ Compute run time ------</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>ionise_runs <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">is.null</span>(cached_runtime)){</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>    <span class="co"># run model defined using IONISE</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>    <span class="fu">mean_trajectory_SEIR_dist_input</span>(</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>      <span class="at">timespan =</span> ionise_time,</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>      <span class="at">theta =</span> ionise_params,</span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>      <span class="at">y_init =</span> inonise_init,</span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>      <span class="at">dist_type =</span> <span class="st">&quot;gamma&quot;</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>    ),</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>    <span class="at">iterations =</span> total_runs</span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>  )<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>  cached_runtime<span class="sc">$</span>ionise_runs</span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>}</span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a><span class="co"># ----- Format output ------ </span></span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>ionise_out <span class="ot">&lt;-</span> <span class="fu">mean_trajectory_SEIR_dist_input</span>(</span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>  <span class="at">timespan =</span> ionise_time,</span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a>  <span class="at">theta =</span> ionise_params,</span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a>  <span class="at">y_init =</span> inonise_init,</span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>  <span class="at">dist_type =</span> <span class="st">&quot;gamma&quot;</span></span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a>    <span class="at">S =</span> St,</span>
<span id="cb25-35"><a href="#cb25-35" tabindex="-1"></a>    <span class="at">E =</span> Et,</span>
<span id="cb25-36"><a href="#cb25-36" tabindex="-1"></a>    <span class="at">I =</span> It,</span>
<span id="cb25-37"><a href="#cb25-37" tabindex="-1"></a>    <span class="at">R =</span> Rt</span>
<span id="cb25-38"><a href="#cb25-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb25-39"><a href="#cb25-39" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-40"><a href="#cb25-40" tabindex="-1"></a>    <span class="at">time =</span> ionise_time</span>
<span id="cb25-41"><a href="#cb25-41" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>ionise_runs</span></code></pre></div>
<pre><code>##  [1] 0.06817070 0.05149485 0.05189616 0.05826383 0.05112364 0.05867895
##  [7] 0.05057096 0.05153241 0.12881015 0.05100023 0.05732948 0.05045144
## [13] 0.05128989 0.05709283 0.05034919 0.05779532 0.05209374 0.05119198
## [19] 0.05720627 0.05115365 0.05116361 0.05699221 0.05041499 0.05767786
## [25] 0.05027904 0.05104139 0.05675511 0.04968548 0.05187390 0.05704781
## [31] 0.05065263 0.05773714 0.05060056 0.05073750 0.05742308 0.05149723
## [37] 0.05251399 0.05981601 0.05161666 0.05888576 0.05061868 0.05158292
## [43] 0.05758171 0.05078067 0.05907190 0.05111150 0.05140580 0.05803812
## [49] 0.05099039 0.05164077
## attr(,&quot;class&quot;)
## [1] &quot;bench_time&quot; &quot;numeric&quot;</code></pre>
<p>Median run time for IONISE: 0.0515998 seconds</p>
</div>
<div id="diffeqr" class="section level2">
<h2>4. diffeqr</h2>
<p>Simulate model using <code>diffeqr</code> package <span
class="citation">(Rackauckas, n.d.)</span></p>
<details>
<summary>
Dependency version specifications
</summary>
<p>R package</p>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Version</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>diffeqr</td>
<td>2.0.0</td>
<td></td>
</tr>
</tbody>
</table>
<p>Julia packages</p>
<table>
<thead>
<tr class="header">
<th>Package</th>
<th>Version</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DifferentialEquations</td>
<td>7.13.0</td>
<td></td>
</tr>
<tr class="even">
<td>ModelingToolkit</td>
<td>8.76.0</td>
<td></td>
</tr>
<tr class="odd">
<td>Suppressor</td>
<td>0.2.8</td>
<td></td>
</tr>
<tr class="even">
<td>SciMLBase</td>
<td>2.15.2</td>
<td></td>
</tr>
<tr class="odd">
<td>RCall</td>
<td>0.13.18</td>
<td></td>
</tr>
</tbody>
</table>
</details>
<div id="model-in-r-1" class="section level3">
<h3>4.1. Model in R</h3>
<details>
<summary>
Code for running SEIR using <code>diffeqr</code>
</summary>
<p>Setup Julia for <code>diffeqr</code></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># load library</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a><span class="fu">library</span>(diffeqr)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="co"># uncomment to check Julia version</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="co"># JuliaCall::julia_command(&quot;VERSION&quot;)</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="co"># uncomment to resolve error: type RFunction has no field r</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="co"># JuliaCall::julia_command(&#39;using Pkg; Pkg.add(PackageSpec(name = &quot;ModelingToolkit&quot;, version = &quot;8.76.0&quot;))&#39;)</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="co"># uncomment to check installed packages version</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="co"># JuliaCall::julia_command(&#39;using Pkg; Pkg.installed()&#39;)</span></span></code></pre></div>
<p>Set up SEIR model</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># --- Transition def for diffeqr ------ </span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>diffeqr_transition <span class="ot">&lt;-</span> <span class="cf">function</span>(u, p, t){</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  <span class="co"># p - gamma_rate_I, shape_I, gamma_rate_R, shape_R, R0, N</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  <span class="co"># u - S, E1, E2, E, I1, I2, I, R</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>  tr <span class="ot">=</span> p[<span class="dv">4</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">/</span>p[<span class="dv">3</span>])</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>  </span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>  dS <span class="ot">=</span> <span class="sc">-</span> (p[<span class="dv">5</span>]<span class="sc">/</span>tr) <span class="sc">*</span> u[<span class="dv">1</span>] <span class="sc">*</span> u[<span class="dv">7</span>]<span class="sc">/</span>p[<span class="dv">6</span>]</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>  <span class="co"># apply linear chain trick</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>  dE1 <span class="ot">=</span> (p[<span class="dv">5</span>]<span class="sc">/</span>tr) <span class="sc">*</span> u[<span class="dv">1</span>] <span class="sc">*</span> u[<span class="dv">7</span>]<span class="sc">/</span>p[<span class="dv">6</span>] <span class="sc">-</span> p[<span class="dv">1</span>]<span class="sc">*</span>u[<span class="dv">2</span>]</span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>  dE2 <span class="ot">=</span> p[<span class="dv">1</span>]<span class="sc">*</span>u[<span class="dv">2</span>] <span class="sc">-</span> p[<span class="dv">1</span>]<span class="sc">*</span>u[<span class="dv">3</span>]</span>
<span id="cb29-11"><a href="#cb29-11" tabindex="-1"></a>  dE <span class="ot">=</span> dE1 <span class="sc">+</span> dE2</span>
<span id="cb29-12"><a href="#cb29-12" tabindex="-1"></a>  dI1 <span class="ot">=</span> p[<span class="dv">1</span>]<span class="sc">*</span>u[<span class="dv">3</span>] <span class="sc">-</span> p[<span class="dv">3</span>]<span class="sc">*</span>u[<span class="dv">5</span>]</span>
<span id="cb29-13"><a href="#cb29-13" tabindex="-1"></a>  dI2 <span class="ot">=</span> p[<span class="dv">3</span>]<span class="sc">*</span>u[<span class="dv">5</span>] <span class="sc">-</span> p[<span class="dv">3</span>]<span class="sc">*</span>u[<span class="dv">6</span>]</span>
<span id="cb29-14"><a href="#cb29-14" tabindex="-1"></a>  dI <span class="ot">=</span>  dI1 <span class="sc">+</span> dI2</span>
<span id="cb29-15"><a href="#cb29-15" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" tabindex="-1"></a>  dR <span class="ot">=</span> p[<span class="dv">3</span>]<span class="sc">*</span>u[<span class="dv">6</span>]</span>
<span id="cb29-17"><a href="#cb29-17" tabindex="-1"></a>  </span>
<span id="cb29-18"><a href="#cb29-18" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(dS, dE1, dE2, dE, dI1, dI2, dI, dR))</span>
<span id="cb29-19"><a href="#cb29-19" tabindex="-1"></a>}</span>
<span id="cb29-20"><a href="#cb29-20" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" tabindex="-1"></a>diffeqr_time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, sim_duration)</span>
<span id="cb29-22"><a href="#cb29-22" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" tabindex="-1"></a><span class="co"># ---- Parameter setup -----</span></span>
<span id="cb29-24"><a href="#cb29-24" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">gamma_rate_I =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">shape_I=</span><span class="dv">2</span>,</span>
<span id="cb29-25"><a href="#cb29-25" tabindex="-1"></a>                <span class="at">gamma_rate_R =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">shape_R =</span> <span class="dv">2</span>,</span>
<span id="cb29-26"><a href="#cb29-26" tabindex="-1"></a>                <span class="at">R0 =</span> <span class="fl">3.5</span>, <span class="at">N =</span> <span class="fl">1e6</span>) </span>
<span id="cb29-27"><a href="#cb29-27" tabindex="-1"></a>initialValues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> <span class="dv">999999</span>, <span class="at">E1 =</span> <span class="dv">1</span>,</span>
<span id="cb29-28"><a href="#cb29-28" tabindex="-1"></a>                   <span class="at">E2 =</span> <span class="dv">0</span>, <span class="at">E =</span> <span class="dv">0</span>, <span class="at">I1=</span><span class="dv">0</span>, </span>
<span id="cb29-29"><a href="#cb29-29" tabindex="-1"></a>                   <span class="at">I2=</span><span class="dv">0</span>, <span class="at">I=</span><span class="dv">0</span>, <span class="at">R=</span><span class="dv">0</span></span>
<span id="cb29-30"><a href="#cb29-30" tabindex="-1"></a>                   )</span>
<span id="cb29-31"><a href="#cb29-31" tabindex="-1"></a></span>
<span id="cb29-32"><a href="#cb29-32" tabindex="-1"></a><span class="co"># set up diffeqr solverr</span></span>
<span id="cb29-33"><a href="#cb29-33" tabindex="-1"></a>setup <span class="ot">&lt;-</span> <span class="fu">diffeq_setup</span>()</span></code></pre></div>
<pre><code>## Julia version 1.9.4 at location /Users/anhptq/Library/Application Support/org.R-project.R/R/JuliaCall/julia/1.9.4/julia-1.9.4/bin will be used.</code></pre>
<pre><code>## Loading setup script for JuliaCall...</code></pre>
<pre><code>## Finish loading setup script for JuliaCall.</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># we can use initialValues and parameters set up for deSolve</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>diffeqr_mod <span class="ot">&lt;-</span> setup<span class="sc">$</span><span class="fu">ODEProblem</span>(diffeqr_transition, </span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>                                initialValues,</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>                                diffeqr_time, </span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>                                parameters)</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="co"># ------ Compute run time ------</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a>diffeqr_base_runs <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">is.null</span>(cached_runtime)){</span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a>    setup<span class="sc">$</span><span class="fu">solve</span>(diffeqr_mod),</span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>    <span class="at">iterations =</span> total_runs</span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a>  )<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a>  cached_runtime<span class="sc">$</span>diffeqr_base_runs</span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a>}</span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a><span class="co"># ----- Format output ------ </span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a>sol <span class="ot">&lt;-</span> setup<span class="sc">$</span><span class="fu">solve</span>(diffeqr_mod)</span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a>out_mat <span class="ot">&lt;-</span> <span class="fu">sapply</span>(sol<span class="sc">$</span>u,identity)</span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a><span class="co"># convert to data.frame</span></span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a>diffeqr_out <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(out_mat))</span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a><span class="co"># add names</span></span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a><span class="fu">names</span>(diffeqr_out) <span class="ot">&lt;-</span> <span class="fu">names</span>(initialValues)</span>
<span id="cb33-25"><a href="#cb33-25" tabindex="-1"></a><span class="co"># add time column</span></span>
<span id="cb33-26"><a href="#cb33-26" tabindex="-1"></a>diffeqr_out <span class="ot">&lt;-</span> diffeqr_out <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb33-27"><a href="#cb33-27" tabindex="-1"></a>    <span class="at">time =</span> <span class="fu">identity</span>(sol<span class="sc">$</span>t)</span>
<span id="cb33-28"><a href="#cb33-28" tabindex="-1"></a>  )</span></code></pre></div>
</details>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>diffeqr_base_runs</span></code></pre></div>
<pre><code>##  [1] 0.002693413 0.002484805 0.002288702 0.002978978 0.002667460 0.002320682
##  [7] 0.002303790 0.002602516 0.002445568 0.002196616 0.002118142 0.002151434
## [13] 0.002274475 0.002166645 0.002083292 0.002099159 0.002242372 0.002268038
## [19] 0.002162381 0.002131016 0.002185177 0.002274352 0.002062259 0.002014535
## [25] 0.001937906 0.001981366 0.002181487 0.002094198 0.002041759 0.001970624
## [31] 0.004588023 0.002119905 0.001975503 0.001952133 0.001925770 0.001989361
## [37] 0.001940612 0.002008836 0.001933355 0.001972879 0.001980505 0.001998709
## [43] 0.001989566 0.002060619 0.002003342 0.001982473 0.001994404 0.001954265
## [49] 0.002002440 0.001978865
## attr(,&quot;class&quot;)
## [1] &quot;bench_time&quot; &quot;numeric&quot;</code></pre>
<p>Median run time for <code>diffeqr</code> with base solver: 0.0020887
seconds</p>
</div>
<div id="define-model-in-julia" class="section level3">
<h3>4.2. Define model in Julia</h3>
<details>
<summary>
Code to set up model in Julia using <code>diffeqr</code>
</summary>
<p>We can tell <code>diffeqr</code> to define model in Julia, so we can
utilize Julia JIT compiler which can improve the runtime.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># define model in Julia instead</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>optimized_mod <span class="ot">&lt;-</span> diffeqr<span class="sc">::</span><span class="fu">jitoptimize_ode</span>(setup, diffeqr_mod)</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>diffeqr_optimized_runs <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">is.null</span>(cached_runtime)){</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>    <span class="fu">solve</span>(optimized_mod, setup<span class="sc">$</span><span class="fu">Tsit5</span>()),</span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>    <span class="at">iterations =</span> total_runs</span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>  )<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a>  cached_runtime<span class="sc">$</span>diffeqr_optimized_runs</span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a>}</span></code></pre></div>
</details>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>diffeqr_optimized_runs</span></code></pre></div>
<pre><code>##  [1] 0.000206886 0.000160638 0.000143377 0.000120294 0.000098236 0.000117506
##  [7] 0.000127264 0.000111438 0.000104878 0.000106682 0.000099917 0.000109019
## [13] 0.000103771 0.000102090 0.000142680 0.000095120 0.000121483 0.000105739
## [19] 0.000107953 0.000107338 0.000096965 0.000107502 0.000104017 0.000094136
## [25] 0.000102951 0.000120089 0.000126977 0.000115784 0.000110577 0.000099671
## [31] 0.000111192 0.000112381 0.000083476 0.000091020 0.000101926 0.000090200
## [37] 0.000084132 0.000091717 0.000090487 0.000093521 0.000088970 0.000083763
## [43] 0.000094505 0.000096145 0.000090159 0.000091635 0.000086100 0.000087248
## [49] 0.000094710 0.000082697
## attr(,&quot;class&quot;)
## [1] &quot;bench_time&quot; &quot;numeric&quot;</code></pre>
<p>Median run time for IONISE: 1.025205^{-4} seconds</p>
</div>
</div>
<div id="sec-odin" class="section level2">
<h2>5. odin</h2>
<p>We also implement uSEIR model with denim’s algorithm using
<code>odin</code> package <span class="citation">(FitzJohn et al.
2024)</span> for comparison</p>
<details>
<summary>
Dependency version specifications
</summary>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Version</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>odin2</td>
<td>0.3.26</td>
<td></td>
</tr>
</tbody>
</table>
</details>
<details>
<summary>
Code for running SEIR in <code>odin</code>
</summary>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="co"># ---- Install packages -----</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="co"># install.packages(</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="co">#   &quot;odin2&quot;,</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="co">#   repos = c(&quot;https://mrc-ide.r-universe.dev&quot;, &quot;https://cloud.r-project.org&quot;))</span></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a><span class="co"># install.packages(</span></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a><span class="co">#   &quot;dust2&quot;,</span></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a><span class="co">#   repos = c(&quot;https://mrc-ide.r-universe.dev&quot;, &quot;https://cloud.r-project.org&quot;))</span></span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a><span class="fu">library</span>(odin2)</span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>odin_mod <span class="ot">&lt;-</span> odin2<span class="sc">::</span><span class="fu">odin</span>(</span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>  {</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a>    <span class="co"># ----- Define algo to update compartments here ---------</span></span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a>    <span class="fu">update</span>(S) <span class="ot">&lt;-</span> S <span class="sc">-</span> dt <span class="sc">*</span> (R0<span class="sc">/</span>tr) <span class="sc">*</span> S <span class="sc">*</span> <span class="fu">sum</span>(I)<span class="sc">/</span>N</span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a>    <span class="co"># --- E compartment ------</span></span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a>    <span class="fu">update</span>(E[<span class="dv">1</span>]) <span class="ot">&lt;-</span> dt <span class="sc">*</span> (R0<span class="sc">/</span>tr) <span class="sc">*</span> S <span class="sc">*</span> <span class="fu">sum</span>(I)<span class="sc">/</span>N</span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a>    <span class="co"># starting from 2: to simulate individuals staying in E for another timestep</span></span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a>    <span class="fu">update</span>(E[<span class="dv">2</span><span class="sc">:</span>e_maxtime]) <span class="ot">&lt;-</span> E[i<span class="dv">-1</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>e_transprob[i<span class="dv">-1</span>])</span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a>    </span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a>    <span class="co"># compute total population from E -&gt; I</span></span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a>    <span class="fu">dim</span>(E_to_I) <span class="ot">&lt;-</span> e_maxtime</span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a>    E_to_I[<span class="dv">1</span><span class="sc">:</span>e_maxtime] <span class="ot">&lt;-</span> e_transprob[i]<span class="sc">*</span>E[i]</span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a>    sum_E_to_I <span class="ot">&lt;-</span> <span class="fu">sum</span>(E_to_I)</span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a>    </span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a>    <span class="co"># --- I compartment ------</span></span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a>    <span class="fu">update</span>(I[<span class="dv">1</span>]) <span class="ot">&lt;-</span> sum_E_to_I</span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a>    <span class="fu">update</span>(I[<span class="dv">2</span><span class="sc">:</span>i_maxtime]) <span class="ot">&lt;-</span> I[i<span class="dv">-1</span>]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>i_transprob[i<span class="dv">-1</span>])</span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a>    </span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a>    <span class="co"># compute total population from I -&gt; R</span></span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a>    <span class="fu">dim</span>(I_to_R) <span class="ot">&lt;-</span> i_maxtime</span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a>    I_to_R[<span class="dv">1</span><span class="sc">:</span>i_maxtime] <span class="ot">&lt;-</span> i_transprob[i]<span class="sc">*</span>I[i]</span>
<span id="cb39-32"><a href="#cb39-32" tabindex="-1"></a>    sum_I_to_R <span class="ot">&lt;-</span> <span class="fu">sum</span>(I_to_R)</span>
<span id="cb39-33"><a href="#cb39-33" tabindex="-1"></a></span>
<span id="cb39-34"><a href="#cb39-34" tabindex="-1"></a>    <span class="co"># --- R compartment ------</span></span>
<span id="cb39-35"><a href="#cb39-35" tabindex="-1"></a>    <span class="fu">update</span>(R) <span class="ot">&lt;-</span> R <span class="sc">+</span> sum_I_to_R</span>
<span id="cb39-36"><a href="#cb39-36" tabindex="-1"></a>    </span>
<span id="cb39-37"><a href="#cb39-37" tabindex="-1"></a>    <span class="co"># initialize population from input</span></span>
<span id="cb39-38"><a href="#cb39-38" tabindex="-1"></a>    <span class="fu">initial</span>(S) <span class="ot">&lt;-</span> S_init</span>
<span id="cb39-39"><a href="#cb39-39" tabindex="-1"></a>    <span class="fu">initial</span>(E[]) <span class="ot">&lt;-</span> E_init[i]</span>
<span id="cb39-40"><a href="#cb39-40" tabindex="-1"></a>    <span class="fu">dim</span>(E) <span class="ot">&lt;-</span> e_maxtime</span>
<span id="cb39-41"><a href="#cb39-41" tabindex="-1"></a>    <span class="fu">initial</span>(I[]) <span class="ot">&lt;-</span> I_init[i]</span>
<span id="cb39-42"><a href="#cb39-42" tabindex="-1"></a>    <span class="fu">dim</span>(I) <span class="ot">&lt;-</span> i_maxtime</span>
<span id="cb39-43"><a href="#cb39-43" tabindex="-1"></a>    <span class="fu">initial</span>(R) <span class="ot">&lt;-</span> R_init</span>
<span id="cb39-44"><a href="#cb39-44" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" tabindex="-1"></a>    <span class="co"># ----- Inputs -------</span></span>
<span id="cb39-46"><a href="#cb39-46" tabindex="-1"></a>    R0 <span class="ot">&lt;-</span> <span class="fu">parameter</span>()</span>
<span id="cb39-47"><a href="#cb39-47" tabindex="-1"></a>    tr <span class="ot">&lt;-</span> <span class="fu">parameter</span>()</span>
<span id="cb39-48"><a href="#cb39-48" tabindex="-1"></a>    </span>
<span id="cb39-49"><a href="#cb39-49" tabindex="-1"></a>    <span class="co"># transition prob of E</span></span>
<span id="cb39-50"><a href="#cb39-50" tabindex="-1"></a>    e_transprob<span class="ot">&lt;-</span> <span class="fu">parameter</span>()</span>
<span id="cb39-51"><a href="#cb39-51" tabindex="-1"></a>    e_maxtime <span class="ot">&lt;-</span> <span class="fu">parameter</span>()</span>
<span id="cb39-52"><a href="#cb39-52" tabindex="-1"></a>    <span class="fu">dim</span>(e_transprob) <span class="ot">&lt;-</span> e_maxtime</span>
<span id="cb39-53"><a href="#cb39-53" tabindex="-1"></a>    </span>
<span id="cb39-54"><a href="#cb39-54" tabindex="-1"></a>    <span class="co"># transition prob of I</span></span>
<span id="cb39-55"><a href="#cb39-55" tabindex="-1"></a>    i_transprob <span class="ot">&lt;-</span> <span class="fu">parameter</span>()</span>
<span id="cb39-56"><a href="#cb39-56" tabindex="-1"></a>    i_maxtime <span class="ot">&lt;-</span> <span class="fu">parameter</span>()</span>
<span id="cb39-57"><a href="#cb39-57" tabindex="-1"></a>    <span class="fu">dim</span>(i_transprob) <span class="ot">&lt;-</span> i_maxtime</span>
<span id="cb39-58"><a href="#cb39-58" tabindex="-1"></a>    </span>
<span id="cb39-59"><a href="#cb39-59" tabindex="-1"></a>    </span>
<span id="cb39-60"><a href="#cb39-60" tabindex="-1"></a>    <span class="co"># initial populations</span></span>
<span id="cb39-61"><a href="#cb39-61" tabindex="-1"></a>    S_init <span class="ot">&lt;-</span> <span class="fu">user</span>()</span>
<span id="cb39-62"><a href="#cb39-62" tabindex="-1"></a>    E_init <span class="ot">&lt;-</span> <span class="fu">user</span>()</span>
<span id="cb39-63"><a href="#cb39-63" tabindex="-1"></a>    <span class="fu">dim</span>(E_init) <span class="ot">&lt;-</span> e_maxtime</span>
<span id="cb39-64"><a href="#cb39-64" tabindex="-1"></a>    I_init <span class="ot">&lt;-</span> <span class="fu">user</span>()</span>
<span id="cb39-65"><a href="#cb39-65" tabindex="-1"></a>    <span class="fu">dim</span>(I_init) <span class="ot">&lt;-</span> i_maxtime</span>
<span id="cb39-66"><a href="#cb39-66" tabindex="-1"></a>    R_init <span class="ot">&lt;-</span> <span class="fu">user</span>()</span>
<span id="cb39-67"><a href="#cb39-67" tabindex="-1"></a>    N <span class="ot">&lt;-</span> <span class="fu">parameter</span>(<span class="dv">1000</span>)</span>
<span id="cb39-68"><a href="#cb39-68" tabindex="-1"></a>  }</span>
<span id="cb39-69"><a href="#cb39-69" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning in odin2::odin({: [1m[22mFound 4 compatibility issues
## Replace calls to &#39;user()&#39; with &#39;parameter()&#39;
## [31m✖[39m S_init &lt;- user()
## [32m✔[39m S_init &lt;- parameter()
## [31m✖[39m E_init &lt;- user()
## [32m✔[39m E_init &lt;- parameter()
## [31m✖[39m I_init &lt;- user()
## [32m✔[39m I_init &lt;- parameter()
## [31m✖[39m R_init &lt;- user()
## [32m✔[39m R_init &lt;- parameter()</code></pre>
<pre><code>## [36m──[39m [36mR CMD INSTALL[39m [36m───────────────────────────────────────────────────────────────[39m
## * installing *source* package ‘odin.system79e020ca’ ...
## ** using staged installation
## ** libs
## using C++ compiler: ‘Apple clang version 17.0.0 (clang-1700.0.13.5)’
## using SDK: ‘NA’
## clang++ -arch arm64 -std=gnu++17 -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG -O2 -I&#39;/Users/anhptq/Library/R/arm64/4.3/library/cpp11/include&#39; -I&#39;/Users/anhptq/Library/R/arm64/4.3/library/dust2/include&#39; -I&#39;/Users/anhptq/Library/R/arm64/4.3/library/monty/include&#39; -I/opt/R/arm64/include   -DHAVE_INLINE   -fPIC  -isystem /Library/Developer/CommandLineTools/SDKs/MacOSX15.5.sdk/usr/include/c++/v1 -O2 -c cpp11.cpp -o cpp11.o
## clang++ -arch arm64 -std=gnu++17 -I&quot;/Library/Frameworks/R.framework/Resources/include&quot; -DNDEBUG -O2 -I&#39;/Users/anhptq/Library/R/arm64/4.3/library/cpp11/include&#39; -I&#39;/Users/anhptq/Library/R/arm64/4.3/library/dust2/include&#39; -I&#39;/Users/anhptq/Library/R/arm64/4.3/library/monty/include&#39; -I/opt/R/arm64/include   -DHAVE_INLINE   -fPIC  -isystem /Library/Developer/CommandLineTools/SDKs/MacOSX15.5.sdk/usr/include/c++/v1 -O2 -c dust.cpp -o dust.o
## clang++ -arch arm64 -std=gnu++17 -dynamiclib -Wl,-headerpad_max_install_names -undefined dynamic_lookup -single_module -multiply_defined suppress -L/Library/Frameworks/R.framework/Resources/lib -L/Library/Developer/CommandLineTools/SDKs/MacOSX15.5.sdk/usr/lib -L/opt/homebrew/opt/libomp/lib -lomp -o odin.system79e020ca.so cpp11.o dust.o -F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework -Wl,CoreFoundation
## ld: warning: -single_module is obsolete
## ld: warning: -multiply_defined is obsolete
## installing to /private/var/folders/rf/dwxhm19j1ws1mfmsvj9yfp140000gr/T/RtmpohkXi9/devtools_install_1001ffb1e6ba/00LOCK-dust_1001f7543da38/00new/odin.system79e020ca/libs
## ** checking absolute paths in shared objects and dynamic libraries
## * DONE (odin.system79e020ca)</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>compute_transprob <span class="ot">&lt;-</span> <span class="cf">function</span>(dist_func,..., <span class="at">timestep=</span><span class="fl">0.05</span>, <span class="at">error_tolerance=</span><span class="fl">0.001</span>){</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>  maxtime <span class="ot">&lt;-</span> timestep</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>  prev_prob <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>  transprob <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a>  cumulative_dist <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a>  prob_dist <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a>  </span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a>  <span class="cf">while</span>(<span class="cn">TRUE</span>){</span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a>     <span class="co"># get current cumulative prob and check whether it is sufficiently close to 1</span></span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a>     temp_prob <span class="ot">&lt;-</span>  <span class="fu">ifelse</span>(</span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a>       <span class="fu">dist_func</span>(maxtime, ...) <span class="sc">&lt;</span> (<span class="dv">1</span> <span class="sc">-</span> error_tolerance), </span>
<span id="cb42-12"><a href="#cb42-12" tabindex="-1"></a>       <span class="fu">dist_func</span>(maxtime, ...), </span>
<span id="cb42-13"><a href="#cb42-13" tabindex="-1"></a>       <span class="dv">1</span>);</span>
<span id="cb42-14"><a href="#cb42-14" tabindex="-1"></a>     cumulative_dist <span class="ot">&lt;-</span> <span class="fu">c</span>(cumulative_dist, temp_prob)</span>
<span id="cb42-15"><a href="#cb42-15" tabindex="-1"></a>     </span>
<span id="cb42-16"><a href="#cb42-16" tabindex="-1"></a>     <span class="co"># get f(t)</span></span>
<span id="cb42-17"><a href="#cb42-17" tabindex="-1"></a>     curr_prob <span class="ot">&lt;-</span> temp_prob <span class="sc">-</span> prev_prob</span>
<span id="cb42-18"><a href="#cb42-18" tabindex="-1"></a>     prob_dist <span class="ot">&lt;-</span> <span class="fu">c</span>(prob_dist, curr_prob)</span>
<span id="cb42-19"><a href="#cb42-19" tabindex="-1"></a>     </span>
<span id="cb42-20"><a href="#cb42-20" tabindex="-1"></a>     <span class="co"># compute transprob</span></span>
<span id="cb42-21"><a href="#cb42-21" tabindex="-1"></a>     curr_transprob <span class="ot">&lt;-</span> curr_prob<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>prev_prob)</span>
<span id="cb42-22"><a href="#cb42-22" tabindex="-1"></a>     transprob <span class="ot">&lt;-</span> <span class="fu">c</span>(transprob, curr_transprob)</span>
<span id="cb42-23"><a href="#cb42-23" tabindex="-1"></a>     </span>
<span id="cb42-24"><a href="#cb42-24" tabindex="-1"></a>     prev_prob <span class="ot">&lt;-</span> temp_prob</span>
<span id="cb42-25"><a href="#cb42-25" tabindex="-1"></a>     maxtime <span class="ot">&lt;-</span> maxtime <span class="sc">+</span> timestep</span>
<span id="cb42-26"><a href="#cb42-26" tabindex="-1"></a>     </span>
<span id="cb42-27"><a href="#cb42-27" tabindex="-1"></a>     <span class="cf">if</span>(temp_prob <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb42-28"><a href="#cb42-28" tabindex="-1"></a>       <span class="cf">break</span></span>
<span id="cb42-29"><a href="#cb42-29" tabindex="-1"></a>     }</span>
<span id="cb42-30"><a href="#cb42-30" tabindex="-1"></a>  }</span>
<span id="cb42-31"><a href="#cb42-31" tabindex="-1"></a>  </span>
<span id="cb42-32"><a href="#cb42-32" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb42-33"><a href="#cb42-33" tabindex="-1"></a>    <span class="at">prob_dist =</span> prob_dist,</span>
<span id="cb42-34"><a href="#cb42-34" tabindex="-1"></a>    <span class="at">cumulative_dist =</span> cumulative_dist,</span>
<span id="cb42-35"><a href="#cb42-35" tabindex="-1"></a>    <span class="at">transprob =</span> transprob</span>
<span id="cb42-36"><a href="#cb42-36" tabindex="-1"></a>  )</span>
<span id="cb42-37"><a href="#cb42-37" tabindex="-1"></a>}</span></code></pre></div>
<p>Run model for bench mark. Note that the process of computing the
transition probability is also included as part of the benchmark for a
fair comparison with denim.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>timeStep <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>errorTolerance <span class="ot">&lt;-</span> <span class="fl">0.001</span></span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>run_useir_odin <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>  <span class="co"># ---- Compute transprob ----- </span></span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a>  e_transprob <span class="ot">&lt;-</span> <span class="fu">compute_transprob</span>(pgamma, <span class="at">rate=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">shape=</span><span class="dv">2</span>, </span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a>                                   <span class="at">timestep =</span> timeStep, <span class="at">error_tolerance =</span> errorTolerance)<span class="sc">$</span>transprob</span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>  i_transprob <span class="ot">&lt;-</span> <span class="fu">compute_transprob</span>(pgamma, <span class="at">rate=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">2</span>, </span>
<span id="cb43-9"><a href="#cb43-9" tabindex="-1"></a>                                   <span class="at">timestep =</span> timeStep, <span class="at">error_tolerance =</span> errorTolerance)<span class="sc">$</span>transprob</span>
<span id="cb43-10"><a href="#cb43-10" tabindex="-1"></a>  </span>
<span id="cb43-11"><a href="#cb43-11" tabindex="-1"></a>  <span class="co"># ---- Run model and plot ----- </span></span>
<span id="cb43-12"><a href="#cb43-12" tabindex="-1"></a>  <span class="co"># initialize params</span></span>
<span id="cb43-13"><a href="#cb43-13" tabindex="-1"></a>  odin_pars <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb43-14"><a href="#cb43-14" tabindex="-1"></a>    <span class="at">R0 =</span> <span class="fl">3.5</span>, </span>
<span id="cb43-15"><a href="#cb43-15" tabindex="-1"></a>    <span class="at">tr =</span> <span class="dv">3</span><span class="sc">*</span><span class="dv">2</span>, <span class="co"># compute mean recovery time, for gamma it&#39;s scale*shape</span></span>
<span id="cb43-16"><a href="#cb43-16" tabindex="-1"></a>    <span class="at">N =</span> <span class="fl">1e6</span>,</span>
<span id="cb43-17"><a href="#cb43-17" tabindex="-1"></a>    <span class="at">e_transprob =</span> e_transprob,</span>
<span id="cb43-18"><a href="#cb43-18" tabindex="-1"></a>    <span class="at">e_maxtime =</span> <span class="fu">length</span>(e_transprob),</span>
<span id="cb43-19"><a href="#cb43-19" tabindex="-1"></a>    <span class="at">i_transprob =</span> i_transprob,</span>
<span id="cb43-20"><a href="#cb43-20" tabindex="-1"></a>    <span class="at">i_maxtime =</span> <span class="fu">length</span>(i_transprob),</span>
<span id="cb43-21"><a href="#cb43-21" tabindex="-1"></a>    <span class="at">S_init =</span> <span class="dv">999999</span>, </span>
<span id="cb43-22"><a href="#cb43-22" tabindex="-1"></a>    <span class="at">E_init =</span> <span class="fu">array</span>( <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(e_transprob) <span class="sc">-</span> <span class="dv">1</span>) ) ),</span>
<span id="cb43-23"><a href="#cb43-23" tabindex="-1"></a>    <span class="at">I_init =</span> <span class="fu">array</span>( <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(i_transprob)) ),</span>
<span id="cb43-24"><a href="#cb43-24" tabindex="-1"></a>    <span class="at">R_init =</span> <span class="dv">0</span></span>
<span id="cb43-25"><a href="#cb43-25" tabindex="-1"></a>  )</span>
<span id="cb43-26"><a href="#cb43-26" tabindex="-1"></a>  </span>
<span id="cb43-27"><a href="#cb43-27" tabindex="-1"></a>  <span class="co"># run model</span></span>
<span id="cb43-28"><a href="#cb43-28" tabindex="-1"></a>  t_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, sim_duration, <span class="fl">0.25</span>)</span>
<span id="cb43-29"><a href="#cb43-29" tabindex="-1"></a>  odin_seir <span class="ot">&lt;-</span> dust2<span class="sc">::</span><span class="fu">dust_system_create</span>(odin_mod, odin_pars, <span class="at">dt =</span> timeStep)</span>
<span id="cb43-30"><a href="#cb43-30" tabindex="-1"></a>  dust2<span class="sc">::</span><span class="fu">dust_system_set_state_initial</span>(odin_seir)</span>
<span id="cb43-31"><a href="#cb43-31" tabindex="-1"></a>  out <span class="ot">&lt;-</span> dust2<span class="sc">::</span><span class="fu">dust_system_simulate</span>(odin_seir, t_seq)</span>
<span id="cb43-32"><a href="#cb43-32" tabindex="-1"></a>  out <span class="ot">&lt;-</span> dust2<span class="sc">::</span><span class="fu">dust_unpack_state</span>(odin_seir, out)</span>
<span id="cb43-33"><a href="#cb43-33" tabindex="-1"></a>  </span>
<span id="cb43-34"><a href="#cb43-34" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb43-35"><a href="#cb43-35" tabindex="-1"></a>    <span class="at">t =</span> t_seq,</span>
<span id="cb43-36"><a href="#cb43-36" tabindex="-1"></a>    <span class="at">S =</span> out<span class="sc">$</span>S,</span>
<span id="cb43-37"><a href="#cb43-37" tabindex="-1"></a>    <span class="at">E =</span> <span class="fu">colSums</span>(out<span class="sc">$</span>E),</span>
<span id="cb43-38"><a href="#cb43-38" tabindex="-1"></a>    <span class="at">I =</span> <span class="fu">colSums</span>(out<span class="sc">$</span>I),</span>
<span id="cb43-39"><a href="#cb43-39" tabindex="-1"></a>    <span class="at">R =</span> out<span class="sc">$</span>R</span>
<span id="cb43-40"><a href="#cb43-40" tabindex="-1"></a>  )</span>
<span id="cb43-41"><a href="#cb43-41" tabindex="-1"></a>}</span>
<span id="cb43-42"><a href="#cb43-42" tabindex="-1"></a></span>
<span id="cb43-43"><a href="#cb43-43" tabindex="-1"></a><span class="co"># ---- Get runtimes ----</span></span>
<span id="cb43-44"><a href="#cb43-44" tabindex="-1"></a>odin_runs <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">is.null</span>(cached_runtime)){</span>
<span id="cb43-45"><a href="#cb43-45" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>({</span>
<span id="cb43-46"><a href="#cb43-46" tabindex="-1"></a>      <span class="fu">run_useir_odin</span>()</span>
<span id="cb43-47"><a href="#cb43-47" tabindex="-1"></a>    },</span>
<span id="cb43-48"><a href="#cb43-48" tabindex="-1"></a>    <span class="at">iterations =</span> total_runs</span>
<span id="cb43-49"><a href="#cb43-49" tabindex="-1"></a>  )<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb43-50"><a href="#cb43-50" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb43-51"><a href="#cb43-51" tabindex="-1"></a>  cached_runtime<span class="sc">$</span>odin_runs</span>
<span id="cb43-52"><a href="#cb43-52" tabindex="-1"></a>}</span>
<span id="cb43-53"><a href="#cb43-53" tabindex="-1"></a></span>
<span id="cb43-54"><a href="#cb43-54" tabindex="-1"></a>odin_out <span class="ot">&lt;-</span> <span class="fu">run_useir_odin</span>()</span></code></pre></div>
</details>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>odin_runs</span></code></pre></div>
<pre><code>##  [1] 0.5072996 0.3424156 0.3366308 0.3406740 0.3330703 0.3335009 0.3217610
##  [8] 0.3240203 0.3427259 0.4706479 0.3299392 0.3304285 0.3329552 0.3304867
## [15] 0.3227320 0.3148952 0.3188499 0.3263258 0.3322886 0.3458588 0.3416245
## [22] 0.3289546 0.3243573 0.3258650 0.3250313 0.3172627 0.3248926 0.3226293
## [29] 0.3343968 0.3240186 0.3258362 0.3262575 0.3263672 0.3289742 0.3287218
## [36] 0.3273383 0.3233925 0.3302466 0.3367000 0.3328990 0.3254890 0.3263295
## [43] 0.3284959 0.3263799 0.3236712 0.3167945 0.3160050 0.3201000 0.3245766
## [50] 0.3249563
## attr(,&quot;class&quot;)
## [1] &quot;bench_time&quot; &quot;numeric&quot;</code></pre>
<p>Median run time for odin: 0.3263736 seconds</p>
</div>
<div id="denim" class="section level2">
<h2>6. denim</h2>
<div id="parametric" class="section level3">
<h3>6.1. Parametric</h3>
<details>
<summary>
Code for running SEIR in <code>denim</code>
</summary>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a><span class="fu">library</span>(denim)</span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a>timeStep <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a>errorTolerance <span class="ot">&lt;-</span> <span class="fl">0.001</span></span>
<span id="cb46-5"><a href="#cb46-5" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" tabindex="-1"></a>denim_model <span class="ot">&lt;-</span> <span class="fu">denim_dsl</span>({</span>
<span id="cb46-7"><a href="#cb46-7" tabindex="-1"></a>  S <span class="ot">-&gt;</span> E <span class="ot">=</span> (R0<span class="sc">/</span>tr) <span class="sc">*</span> S <span class="sc">*</span> (I<span class="sc">/</span>N) </span>
<span id="cb46-8"><a href="#cb46-8" tabindex="-1"></a>  E <span class="ot">-&gt;</span> I <span class="ot">=</span> <span class="fu">d_gamma</span>(<span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">2</span>)</span>
<span id="cb46-9"><a href="#cb46-9" tabindex="-1"></a>  I <span class="ot">-&gt;</span> R <span class="ot">=</span> <span class="fu">d_gamma</span>(<span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">2</span>)</span>
<span id="cb46-10"><a href="#cb46-10" tabindex="-1"></a>})</span>
<span id="cb46-11"><a href="#cb46-11" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" tabindex="-1"></a>initialValues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> <span class="dv">999999</span>, <span class="at">E =</span> <span class="dv">1</span>, <span class="at">I=</span> <span class="dv">0</span>, <span class="at">R=</span> <span class="dv">0</span>)</span>
<span id="cb46-13"><a href="#cb46-13" tabindex="-1"></a>parameters <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">R0 =</span> <span class="fl">3.5</span>, </span>
<span id="cb46-14"><a href="#cb46-14" tabindex="-1"></a>                <span class="at">tr =</span> <span class="dv">3</span><span class="sc">*</span><span class="dv">2</span>, <span class="co"># compute mean recovery time, for gamma it&#39;s scale*shape</span></span>
<span id="cb46-15"><a href="#cb46-15" tabindex="-1"></a>                <span class="at">N =</span> <span class="fl">1e6</span>)</span>
<span id="cb46-16"><a href="#cb46-16" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" tabindex="-1"></a><span class="co"># ---- Get runtimes ----</span></span>
<span id="cb46-18"><a href="#cb46-18" tabindex="-1"></a>denim_runs <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">is.null</span>(cached_runtime)){</span>
<span id="cb46-19"><a href="#cb46-19" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb46-20"><a href="#cb46-20" tabindex="-1"></a>    <span class="fu">sim</span>(</span>
<span id="cb46-21"><a href="#cb46-21" tabindex="-1"></a>      <span class="at">transitions =</span> denim_model,</span>
<span id="cb46-22"><a href="#cb46-22" tabindex="-1"></a>      <span class="at">initialValues =</span> initialValues,</span>
<span id="cb46-23"><a href="#cb46-23" tabindex="-1"></a>      <span class="at">parameters =</span> parameters,</span>
<span id="cb46-24"><a href="#cb46-24" tabindex="-1"></a>      <span class="at">simulationDuration =</span> sim_duration,</span>
<span id="cb46-25"><a href="#cb46-25" tabindex="-1"></a>      <span class="at">timeStep =</span> timeStep,</span>
<span id="cb46-26"><a href="#cb46-26" tabindex="-1"></a>      <span class="at">errorTolerance =</span> errorTolerance</span>
<span id="cb46-27"><a href="#cb46-27" tabindex="-1"></a>    ), </span>
<span id="cb46-28"><a href="#cb46-28" tabindex="-1"></a>    <span class="at">iterations =</span> total_runs</span>
<span id="cb46-29"><a href="#cb46-29" tabindex="-1"></a>  )<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb46-30"><a href="#cb46-30" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb46-31"><a href="#cb46-31" tabindex="-1"></a>  cached_runtime<span class="sc">$</span>denim_runs</span>
<span id="cb46-32"><a href="#cb46-32" tabindex="-1"></a>}</span>
<span id="cb46-33"><a href="#cb46-33" tabindex="-1"></a></span>
<span id="cb46-34"><a href="#cb46-34" tabindex="-1"></a></span>
<span id="cb46-35"><a href="#cb46-35" tabindex="-1"></a><span class="co"># ---- Get output ----</span></span>
<span id="cb46-36"><a href="#cb46-36" tabindex="-1"></a>denim_out <span class="ot">&lt;-</span> <span class="fu">sim</span>(<span class="at">transitions =</span> denim_model, </span>
<span id="cb46-37"><a href="#cb46-37" tabindex="-1"></a>                     <span class="at">initialValues =</span> initialValues,</span>
<span id="cb46-38"><a href="#cb46-38" tabindex="-1"></a>                     <span class="at">parameters =</span> parameters,</span>
<span id="cb46-39"><a href="#cb46-39" tabindex="-1"></a>                     <span class="at">simulationDuration =</span> sim_duration, <span class="at">timeStep =</span> timeStep)</span>
<span id="cb46-40"><a href="#cb46-40" tabindex="-1"></a><span class="fu">plot</span>(denim_out)</span></code></pre></div>
<p><img src="denim_benchmark_files/figure-html/unnamed-chunk-23-1.png" width="2187.5" /></p>
</details>
<p>Run time for <code>denim</code> implementation</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a>denim_runs</span></code></pre></div>
<pre><code>##  [1] 0.7775783 0.7658625 0.7658219 0.7527552 0.7504584 0.7459896 0.7538721
##  [8] 0.7526610 0.7520982 0.7547207 0.7684007 0.7547187 0.7472895 0.7434827
## [15] 0.7453847 0.7496407 0.7483962 0.7436754 0.7430848 0.7642120 0.7660060
## [22] 0.7527885 0.7441409 0.7522371 0.7532427 0.7507179 0.7445365 0.7521483
## [29] 0.7599063 0.7734088 0.7610964 0.7719678 0.7829652 0.7754629 0.7685974
## [36] 0.7661460 0.7734480 0.7711797 0.7823685 0.7821349 0.7743654 0.7751355
## [43] 0.7751941 0.7624863 0.7716902 0.7782576 0.7795323 0.7513516 0.7737280
## [50] 0.7791423
## attr(,&quot;class&quot;)
## [1] &quot;bench_time&quot; &quot;numeric&quot;</code></pre>
<p>Median run time for denim: 0.7617914 seconds</p>
</div>
<div id="nonparametric" class="section level3">
<h3>6.2. Nonparametric</h3>
<p>We can also define the SEIR model in denim using function
<code>nonparametric()</code> where the dwell-time distribution will be
pre-computed using the helper function from Section @ref(sec-odin)</p>
<details>
<summary>
Code for running SEIR in <code>denim</code>
</summary>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>timeStep <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a>errorTolerance <span class="ot">&lt;-</span> <span class="fl">0.001</span></span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a>denim_nonparametric_model <span class="ot">&lt;-</span> <span class="fu">denim_dsl</span>({</span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a>  S <span class="ot">-&gt;</span> E <span class="ot">=</span> (R0<span class="sc">/</span>tr) <span class="sc">*</span> S <span class="sc">*</span> (I<span class="sc">/</span>N) </span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a>  E <span class="ot">-&gt;</span> I <span class="ot">=</span> <span class="fu">nonparametric</span>(ei_dist) <span class="co">#ei_dist is considered a model parameter</span></span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a>  I <span class="ot">-&gt;</span> R <span class="ot">=</span> <span class="fu">nonparametric</span>(ir_dist) <span class="co">#ir_dist is also a model parameter</span></span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a>})</span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" tabindex="-1"></a>initialValues2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">S =</span> <span class="dv">999999</span>, <span class="at">E =</span> <span class="dv">1</span>, <span class="at">I=</span> <span class="dv">0</span>, <span class="at">R=</span> <span class="dv">0</span>)</span>
<span id="cb49-11"><a href="#cb49-11" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" tabindex="-1"></a>ei_dist <span class="ot">&lt;-</span> <span class="fu">compute_transprob</span>(pgamma, <span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">2</span>, </span>
<span id="cb49-13"><a href="#cb49-13" tabindex="-1"></a>                             <span class="at">timestep =</span> timeStep, <span class="at">error_tolerance =</span> errorTolerance)<span class="sc">$</span>prob_dist</span>
<span id="cb49-14"><a href="#cb49-14" tabindex="-1"></a>ir_dist <span class="ot">&lt;-</span> <span class="fu">compute_transprob</span>(pgamma, <span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">2</span>, </span>
<span id="cb49-15"><a href="#cb49-15" tabindex="-1"></a>                             <span class="at">timestep =</span> timeStep, <span class="at">error_tolerance =</span> errorTolerance)<span class="sc">$</span>prob_dist</span>
<span id="cb49-16"><a href="#cb49-16" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" tabindex="-1"></a>parameters2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">R0 =</span> <span class="fl">3.5</span>, </span>
<span id="cb49-18"><a href="#cb49-18" tabindex="-1"></a>                <span class="at">tr =</span> <span class="dv">3</span><span class="sc">*</span><span class="dv">2</span>, <span class="co"># compute mean recovery time, for gamma it&#39;s scale*shape</span></span>
<span id="cb49-19"><a href="#cb49-19" tabindex="-1"></a>                <span class="at">N =</span> <span class="fl">1e6</span>,</span>
<span id="cb49-20"><a href="#cb49-20" tabindex="-1"></a>                <span class="at">ei_dist =</span> ei_dist, </span>
<span id="cb49-21"><a href="#cb49-21" tabindex="-1"></a>                <span class="at">ir_dist =</span> ir_dist)</span>
<span id="cb49-22"><a href="#cb49-22" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" tabindex="-1"></a><span class="co"># ---- Get runtimes ----</span></span>
<span id="cb49-24"><a href="#cb49-24" tabindex="-1"></a>denim_nonparametric_runs <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">is.null</span>(cached_runtime)){</span>
<span id="cb49-25"><a href="#cb49-25" tabindex="-1"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb49-26"><a href="#cb49-26" tabindex="-1"></a>    <span class="fu">sim</span>(<span class="at">transitions =</span> denim_nonparametric_model,</span>
<span id="cb49-27"><a href="#cb49-27" tabindex="-1"></a>                       <span class="at">initialValues =</span> initialValues2,</span>
<span id="cb49-28"><a href="#cb49-28" tabindex="-1"></a>                       <span class="at">parameters =</span> parameters2,</span>
<span id="cb49-29"><a href="#cb49-29" tabindex="-1"></a>                       <span class="at">simulationDuration =</span> sim_duration, <span class="at">timeStep =</span> timeStep),</span>
<span id="cb49-30"><a href="#cb49-30" tabindex="-1"></a>    <span class="at">iterations =</span> total_runs</span>
<span id="cb49-31"><a href="#cb49-31" tabindex="-1"></a>  )<span class="sc">$</span>time[[<span class="dv">1</span>]]</span>
<span id="cb49-32"><a href="#cb49-32" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb49-33"><a href="#cb49-33" tabindex="-1"></a>  cached_runtime<span class="sc">$</span>denim_nonparametric_runs</span>
<span id="cb49-34"><a href="#cb49-34" tabindex="-1"></a>}</span>
<span id="cb49-35"><a href="#cb49-35" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" tabindex="-1"></a><span class="co"># ---- Get output ----</span></span>
<span id="cb49-37"><a href="#cb49-37" tabindex="-1"></a>denim_nonparametric_out <span class="ot">&lt;-</span> <span class="fu">sim</span>(<span class="at">transitions =</span> denim_nonparametric_model, </span>
<span id="cb49-38"><a href="#cb49-38" tabindex="-1"></a>                     <span class="at">initialValues =</span> initialValues2,</span>
<span id="cb49-39"><a href="#cb49-39" tabindex="-1"></a>                     <span class="at">parameters =</span> parameters2,</span>
<span id="cb49-40"><a href="#cb49-40" tabindex="-1"></a>                     <span class="at">simulationDuration =</span> sim_duration, <span class="at">timeStep =</span> timeStep)</span></code></pre></div>
</details>
<p>Run time for <code>denim</code>, using <code>nonparametric()</code>
with pre-computed distribution</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>denim_nonparametric_runs</span></code></pre></div>
<pre><code>##  [1] 1.231386 1.364033 1.213625 1.203059 1.360039 1.190269 1.179894 1.335714
##  [9] 1.180204 1.173921 1.388920 1.196026 1.213411 1.355098 1.220042 1.209340
## [17] 1.354528 1.218138 1.211499 1.356084 1.214659 1.200451 1.373566 1.206884
## [25] 1.202324 1.370221 1.195023 1.223129 1.378572 1.291881 1.263136 1.487639
## [33] 1.301094 1.289617 1.419765 1.212522 1.199191 1.390638 1.232883 1.197724
## [41] 1.360732 1.216516 1.223262 1.375848 1.201429 1.200430 1.334362 1.213480
## [49] 1.227435 1.360499
## attr(,&quot;class&quot;)
## [1] &quot;bench_time&quot; &quot;numeric&quot;</code></pre>
<p>Median run time for denim using <code>nonparametric()</code> with
pre-computed distribution: 1.2231959 seconds.</p>
<p>This longer run time compared to parametric approach is due to the
overhead of interfacing large vectors (<code>ei_dist</code> and
<code>ir_dist</code> in this example) between R and C++. For this
reason, it is recommended to only use <code>nonparametric()</code> when
the observed distribution cannot be adequately represented by one of the
available parametric transitions.</p>
</div>
</div>
<div id="visualize-output" class="section level2">
<h2>7. Visualize output</h2>
<p>The plot below compare output of discrete time frameworks
(<code>odin</code>, <code>denim</code>, <code>uSEIR</code>) with that of
a continuous time solver <code>deSolve</code>.</p>
<p><img src="denim_benchmark_files/figure-html/unnamed-chunk-28-1.png" width="2187.5" /><img src="denim_benchmark_files/figure-html/unnamed-chunk-28-2.png" width="2187.5" /><img src="denim_benchmark_files/figure-html/unnamed-chunk-28-3.png" width="2187.5" /><img src="denim_benchmark_files/figure-html/unnamed-chunk-28-4.png" width="2187.5" /><img src="denim_benchmark_files/figure-html/unnamed-chunk-28-5.png" width="2187.5" /></p>
</div>
<div id="compare-run-time" class="section level2">
<h2>8. Compare run time</h2>
<p>The following plot shows run time for 50 runs (with horizontal line
showing median run time) of each approach.</p>
<p><img src="denim_benchmark_files/figure-html/unnamed-chunk-30-1.png" width="2187.5" /></p>
</div>
<div id="impact-of-timestep-in-denim" class="section level2">
<h2>9. Impact of timeStep in denim</h2>
<div id="run-time-scaling" class="section level3">
<h3>9.1. Run time scaling</h3>
<p>It is worth noting that runtime for denim is also dependent on
duration of time step (<code>timeStep</code> parameter for
<code>sim</code>).</p>
<p>The following plot demonstrates how run time changes as value for
timeStep changes, using the same model for benchmarking. The values for
timeStep being evaluated are
<code>[0.01, 0.02, 0.05, 0.1, 0.25, 0.5, 1]</code>.</p>
<p><img src="denim_benchmark_files/figure-html/unnamed-chunk-32-1.png" width="2187.5" /></p>
</div>
<div id="impact-on-accuracy" class="section level3">
<h3>9.2. Impact on accuracy</h3>
<p>Aside from run time, duration of time step also impacts the accuracy
of <code>denim</code>’s output.</p>
<p>The following plots demonstrates how precision is compromised as we
increase the duration for time step (with output from
<code>deSolve</code> used as baseline). The values for timeStep being
evaluated are <code>[0.01, 0.1, 0.5, 1]</code>.</p>
<p><img src="denim_benchmark_files/figure-html/unnamed-chunk-33-1.png" width="2187.5" /></p>
<p><img src="denim_benchmark_files/figure-html/unnamed-chunk-34-1.png" width="2187.5" /></p>
<div id="refs" class="references csl-bib-body hanging-indent"
entry-spacing="0">
<div id="ref-fitzjohn2024" class="csl-entry">
FitzJohn, Rich, Thibaut Jombart, Imperial College of Science, and
Technology and Medicine. 2024. <em>Odin: ODE Generation and
Integration</em>. <a
href="https://cran.r-project.org/web/packages/odin/index.html">https://cran.r-project.org/web/packages/odin/index.html</a>.
</div>
<div id="ref-Hernndez2021" class="csl-entry">
Hernández, Pilar, Carlos Pena, Alberto Ramos, and Juan José
Gómez-Cadenas. 2021. <span>“A New Formulation of Compartmental Epidemic
Modelling for Arbitrary Distributions of Incubation and Removal
Times.”</span> Edited by Eric Forgoston. <em>PLOS ONE</em> 16 (2):
e0244107. <a
href="https://doi.org/10.1371/journal.pone.0244107">https://doi.org/10.1371/journal.pone.0244107</a>.
</div>
<div id="ref-hong2024" class="csl-entry">
Hong, Hyukpyo, Eunjin Eom, Hyojung Lee, Sunhwa Choi, Boseung Choi, and
Jae Kyoung Kim. 2024. <span>“Overcoming Bias in Estimating
Epidemiological Parameters with Realistic History-Dependent Disease
Spread Dynamics.”</span> <em>Nature Communications</em> 15 (1). <a
href="https://doi.org/10.1038/s41467-024-53095-7">https://doi.org/10.1038/s41467-024-53095-7</a>.
</div>
<div id="ref-rackauckas" class="csl-entry">
Rackauckas, Christopher. n.d. <span>“Diffeqr: Solving Differential
Equations (ODEs, SDEs, DDEs, DAEs).”</span> <a
href="https://doi.org/10.32614/cran.package.diffeqr">https://doi.org/10.32614/cran.package.diffeqr</a>.
</div>
<div id="ref-soetaert2008" class="csl-entry">
Soetaert, Karline, Thomas Petzoldt, and R. Woodrow Setzer. 2008.
<span>“deSolve: Solvers for Initial Value Problems of Differential
Equations (<span>“</span>ODE<span>”</span>,
<span>“</span>DAE<span>”</span>,
<span>’</span>DDE<span>’</span>),”</span> June. <a
href="http://dx.doi.org/10.32614/CRAN.package.deSolve">http://dx.doi.org/10.32614/CRAN.package.deSolve</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thinh Ong, Anh Phan, Marc Choisy.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>
